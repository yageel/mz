<extend name="Layout/master" />
<block name="title">发货管理-</block>
<block name="head">
</block>
<block name="content">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>发货管理列表</h5>
                    <!--
                    <div class="ibox-tools"> <a class="collapse-link"> <i class="fa fa-chevron-up"></i> </a> <a class="dropdown-toggle" data-toggle="dropdown" href="table_data_tables.html#"> <i class="fa fa-wrench"></i> </a>
                      <ul class="dropdown-menu dropdown-user">
                        <li><a href="table_data_tables.html#">选项1</a> </li>
                        <li><a href="table_data_tables.html#">选项2</a> </li>
                      </ul>
                      <a class="close-link"> <i class="fa fa-times"></i> </a> </div>
                  </div>-->
                    <div class="ibox-content">
                        <div class="">
                            <div class=""><!-- <a href="{:U('/home/edit')}" target="_self" class="btn btn-primary ">添加素材</a>-->
                                <div class="input-group  col-sm-6 pull-right form-group">
                                    <div class="col-sm-3">
                                    <select class="form-control " name="status1">
                                        <option value="" <if condition="$status eq ''">selected</if>>所有状态</option>
                                        <option value="0" <if condition="$status eq '0'">selected</if>>待发货</option>
                                        <option value="1" <if condition="$status eq 1">selected</if>>已发货</option>
                                        <option value="2" <if condition="$status eq 2">selected</if>>已签收</option>
                                        <option value="3" <if condition="$status eq 3">selected</if>>已完成</option>
                                        <option value="4" <if condition="$status eq 4">selected</if>>已关闭</option>
                                    </select>
                                        </div>
                                    <div class="col-sm-3">
                                        <select class="form-control " name="type">
                                            <option value="" <if condition="$type eq '0'">selected</if>>所有类型</option>
                                            <option value="1" <if condition="$type eq '1'">selected</if>>兑换商品</option>
                                            <option value="6" <if condition="$type eq '6'">selected</if>>兑换+购买</option>
                                            <option value="2" <if condition="$type eq 2">selected</if>>抽奖商品</option>
                                            <option value="3" <if condition="$type eq 3">selected</if>>美食地图</option>
                                            <option value="4" <if condition="$type eq 4">selected</if>>活动奖励</option>
                                            <option value="5" <if condition="$type eq 5">selected</if>>红包雨</option>
                                        </select>
                                    </div>
                                    <div class="col-sm-5">
                                    <input type="text" class="form-control" name="kw" value="{$kw}" placeholder="手机号码" />
                                    </div>
                                    <div class="input-group-btn">
                                      <button type="submit" class="btn btn-sm btn-primary">
                                        搜索
                                      </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <table class="table table-striped table-bordered table-hover " id="editable">
                            <thead>
                            <tr>
                                <th>发货编号</th>
                                <th>获奖类型</th>
                                <th>获奖商品</th>
                                <th>获奖用户</th>
                                <th>收货人</th>
                                <th>联系号码</th>
                                <th>发货地址</th>
                                <th>订单备注</th>
                                <th>快递公司</th>
                                <th>快递单号</th>
                                <th>公众号</th>
                                <th>操作时间</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <volist name="list" id="item">
                                <tr class="gradeX">
                                    <td>{$item.id}</td>
                                    <td><if condition="$item.from_type eq 'exchange'"><if condition="$item.goods_class eq 3"><font color="green">兑换+现金</font><else/><font color="green">兑换</font></if>
                                        <elseif condition="$item.from_type eq 'lottery'"/>抽奖
                                        <elseif condition="$item.from_type eq 'msdt'"/>美食地图
                                        <elseif condition="$item.from_type eq 'dadi'"/>活动
                                        <elseif condition="$item.from_type eq 'redrain'"/>红包雨
                                    </if>
                                    </td>
                                    <td>{$item.goods_name}</td>
                                    <td>{$item.wx_name}</td>
                                    <td>{$item.receive_user}</td>
                                    <td>{$item.receive_phone}</td>
                                    <td>{$item.receive_address}{$item.receive_detail_address}</td>
                                    <td>{$item.receive_remark}</td>
                                    <td><input type="text" data-id="{$item.id}" name="express_company" class="form-control" value="{$item.express_company}" /></td>
                                    <td><input type="text" data-id="{$item.id}" name="express_no" class="form-control" value="{$item.express_no}" /></td>
                                    <td>{$item.city_name}</td>
                                    <td><if condition="$item.express_time gt 0">{$item.express_time|date='Y-m-d H:i:s',###}</if></td>
                                    <td>
                                        <select name="status" data-id="{$item.id}" class="form-control">
                                            <option value="0">待发货</option>
                                            <option value="1" <if condition='$item.status eq 1'>selected</if>>已发货</option>
                                            <option value="2" <if condition='$item.status eq 2'>selected</if>>已签收</option>
                                            <option value="3" <if condition='$item.status eq 3'>selected</if>>已完成</option>
                                            <option value="4" <if condition='$item.status eq 4'>selected</if>>已关闭</option>
                                    </select></td>
                                    <td class="center">
                                        <a href="{:U('/express/edit', array('id'=>$item['id']))}"><i class="fa fa-check text-navy"></i> 编辑</a>
                                    </td>
                                </tr>
                            </volist>
                            </tbody>
                        </table>
                        <div class="row ">
                            <div class="pages">
                                {$page}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</block>
<block name="js">
    <script type="text/javascript">
        $('button[type="submit"]').click(function(){
            window.location.href = "{:U('/express/index')}&status="+$('select[name="status1"]').val()+"&kw="+$('input[name="kw"]').val()+"&type="+$('select[name="type"]').val();
        });
        // 状态修改
        $('select[name="status"]').change(function(){
            var id = $(this).attr('data-id');
            var status = $(this).val();
            var index = parent.layer.load(1, {shade: [0.1,'#000']});
            $.ajax({
                type: "post",
                url: "{:U('/express/edit')}",
                data: {id:id, status:status},
                dataType: "json",
                success: function (data) {
                    parent.layer.close(index);
                    if(data.status == 1){
                        //提示层
                        //parent.layer.msg('操作成功',function(){});
                    }
                    // $("input#showTime").val(data[0].demoData);
                }
            });
        });

        // 物流公司
        $('input[name="express_company"]').blur(function(){
            var id = $(this).attr('data-id');
            var value = $.trim($(this).val());
            if(value.length < 1){return false;}
            var index = parent.layer.load(1, {shade: [0.1,'#000']});
            $.ajax({
                type: "post",
                url: "{:U('/express/edit')}",
                data: {id:id, express_company:value},
                dataType: "json",
                success: function (data) {
                    parent.layer.close(index);
                    if(data.status == 1){
                        //提示层
                        //parent.layer.msg('操作成功',function(){});
                    }
                    // $("input#showTime").val(data[0].demoData);
                }
            });
        });

        // 快递单号
        $('input[name="express_no"]').blur(function(){
            var id = $(this).attr('data-id');
            var value = $.trim($(this).val());
            if(value.length < 1){return false;}
            var index = parent.layer.load(1, {shade: [0.1,'#000']});
            $.ajax({
                type: "post",
                url: "{:U('/express/edit')}",
                data: {id:id, express_no:value},
                dataType: "json",
                success: function (data) {
                    parent.layer.close(index);
                    if(data.status == 1){
                        //提示层
                        // parent.layer.msg('操作成功',function(){});
                    }
                    // $("input#showTime").val(data[0].demoData);
                }
            });
        });
    </script>
</block>