<extend name="Layout/master" />
<block name="title">设备编辑-</block>
<block name="head">
</block>
<block name="content">
    <div class="row">

        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class=""> <a href="{:U('/devices/index')}" target="_self" class="btn btn-primary ">返回</a> </div>
                <div class="ibox-title">
                    <h5><a href="{:U('/devices/index')}"> 设备管理</a> > <small>设备编辑</small></h5>
                    <div class="ibox-tools">
                        <a class="collapse-link"> <i class="fa fa-chevron-up"></i> </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <form method="post" name="edit" target="_self" action="{:U('/devices/edit')}" class="form-horizontal">
                        <input type="hidden" name="id" value="{$detail.id}" />
                        <div class="form-group">
                            <label class="col-sm-2 control-label">设备编号：</label>
                            <div class="col-sm-5">
                                <input type="text" name="device_number" value="{$detail.device_number}" maxlength="12" class="form-control input-s" />
                                <span class="help-block m-b-none">*设备编号(自定)</span>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">设备串码：</label>
                            <div class="col-sm-5">
                                <input type="text" name="machine_number" value="{$detail.machine_number}" maxlength="64" class="form-control input-s" />
                                <span class="help-block m-b-none">*设备串码(机器串码,接口使用)</span>
                            </div>
                        </div>

                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">渠道门店名称：</label>
                            <div class="col-sm-5">
                                <select name="channel_user_id" class="form-control input-s" >
                                    <option value="0">选择渠道门店</option>
                                    <volist name="channel_list" id="channel">
                                        <option value="{$channel.id}" <if condition="$channel['id'] eq $detail['channel_user_id']">selected</if>>{$channel.shop_name}</option>
                                    </volist>
                                </select>
                                <span class="help-block m-b-none">*请选择设备对应渠道门店</span>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">门店地址：</label>
                            <div class="col-sm-5">
                                <input type="text" name="shop_address" disabled value="" class="form-control input-s"   />
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">门店经度：</label>
                            <div class="col-sm-5">
                                <input type="text" name="channel_lon" disabled value="" class="form-control input-s"  maxlength="26" />
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">门店维度：</label>
                            <div class="col-sm-5">
                                <input type="text" name="channel_lat" disabled value="" class="form-control input-s"  maxlength="26" />
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">渠道联系人：</label>
                            <div class="col-sm-5">
                                <input type="text" name="channel_contact_name" disabled value="" autocomplete="off" class="form-control input-s" maxlength="26" />
                                <span class="help-block m-b-none">*渠道联系人</span> </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">渠道号码：</label>
                            <div class="col-sm-5">
                                <input type="text" name="channel_mobile" value="" disabled autocomplete="off" class="form-control input-s" maxlength="26" />
                                <span class="help-block m-b-none">*渠道联系号码</span> </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">运营人员：</label>
                            <div class="col-sm-5">
                                <select name="operational_user_id" class="form-control input-s" >
                                    <option value="0">选择运营人员</option>
                                    <volist name="operational_list" id="operational">
                                        <option value="{$operational.id}" <if condition="$operational['id'] eq $detail['operational_user_id']">selected</if>>{$detail[operational_user_id]}-{$operational[id]}={$operational.contact_name}</option>
                                    </volist>
                                </select>
                                <span class="help-block m-b-none">*请选择设备运营人员</span>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">运营号码：</label>
                            <div class="col-sm-5">
                                <input type="text" name="operational_mobile" value="" disabled autocomplete="off" class="form-control input-s" maxlength="26" />
                                <span class="help-block m-b-none">*运营联系号码</span> </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">拥有人员(魔座)：</label>
                            <div class="col-sm-5">
                                <select name="user_id" class="form-control input-s" >
                                    <option value="0">选择拥有人员</option>
                                    <volist name="user_list" id="user">
                                        <option value="{$user.id}"  <if condition="$user['id'] eq $detail['user_id']">selected</if>>{$user.id}-{$detail['user_id']}={$user.contact_name}</option>
                                    </volist>
                                </select>
                                <span class="help-block m-b-none">*请选择设备拥有人员</span>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">魔座号码：</label>
                            <div class="col-sm-5">
                                <input type="text" name="user_mobile" value="" disabled autocomplete="off" class="form-control input-s" maxlength="26" />
                                <span class="help-block m-b-none">*魔座联系号码</span> </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">连接方式：</label>
                            <div class="col-sm-5">
                                <select class="form-control input-s" name="link_mode">
                                    <option value="1">Wifi</option>
                                    <option value="2" <if condition="$detail.link_mode eq 2">selected</if>>其他</option>
                                </select>
                                <span class="help-block m-b-none">*魔座设备连接方式</span> </div>
                        </div>

                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">设备状态：</label>
                            <div class="col-sm-5">
                                <select class="form-control input-s" name="status">
                                    <option value="1">正常</option>
                                    <option value="2" <if condition="$detail.status eq 2">selected</if>>异常</option>
                                    <option value="4" <if condition="$detail.status eq 4">selected</if>>删除</option>
                                </select>
                                <span class="help-block m-b-none">*魔座人员状态</span> </div>
                        </div>

                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-2">
                                <button class="btn btn-primary" type="submit">保存内容</button>
                                <button class="btn btn-white" type="reset">取消</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</block>
<block name="js">
    <script type="text/javascript">
        var global_channel = {:json_encode($channel_list)};
        var global_user = {:json_encode($user_list)};
        var global_operational = {:json_encode($operational_list)};
        // 渠道选择
        $('select[name="channel_user_id"]').change(function(){
            if($(this).val() > 0){
                var user_id = $(this).val();
                for(var i=0; i < global_channel.length; i++){
                    if(global_channel[i]['id'] == user_id){
                        $('input[name="channel_mobile"]').val(global_channel[i]['mobile']);
                        $('input[name="channel_lon"]').val(global_channel[i]['lon']);
                        $('input[name="channel_lat"]').val(global_channel[i]['lat']);
                        $('input[name="shop_address"]').val(global_channel[i]['shop_address']);
                        $('input[name="channel_contact_name"]').val(global_channel[i]['contact_name']);
                        break;
                    }
                }
            }else{
                $('input[name="channel_mobile"]').val('');
                $('input[name="channel_lon"]').val('');
                $('input[name="channel_lat"]').val('');
                $('input[name="shop_address"]').val('');
                $('input[name="channel_contact_name"]').val('');
            }
        });
        var channel_user_id = $('select[name="channel_user_id"]').val();
        for(var i=0; i < global_channel.length; i++){
            if(global_channel[i]['id'] == channel_user_id){
                $('input[name="channel_mobile"]').val(global_channel[i]['mobile']);
                $('input[name="channel_lon"]').val(global_channel[i]['lon']);
                $('input[name="channel_lat"]').val(global_channel[i]['lat']);
                $('input[name="shop_address"]').val(global_channel[i]['shop_address']);
                $('input[name="channel_contact_name"]').val(global_channel[i]['contact_name']);
                break;
            }
        }


        // 运营选择
        $('select[name="operational_user_id"]').change(function(){
            if($(this).val() > 0){
                var user_id = $(this).val();
                for(var i=0; i < global_operational.length; i++){
                    if(global_operational[i]['id'] == user_id){
                        $('input[name="operational_mobile"]').val(global_operational[i]['mobile']);
                        break;
                    }
                }
            }else{
                $('input[name="operational_mobile"]').val('');
            }
        });

        var operational_user_id = $('select[name="operational_user_id"]').val();
        for(var i=0; i < global_operational.length; i++){
            if(global_operational[i]['id'] == operational_user_id){
                $('input[name="operational_mobile"]').val(global_operational[i]['mobile']);
                break;
            }
        }

        // 拥有者选择
        $('select[name="user_id"]').change(function(){
            if($(this).val() > 0){
                var user_id = $(this).val();
               for(var i=0; i < global_user.length; i++){
                   if(global_user[i]['id'] == user_id){
                       $('input[name="user_mobile"]').val(global_user[i]['mobile']);
                       break;
                   }
               }
            }else{
                $('input[name="user_mobile"]').val('');
            }
        });

        var user_id = $('select[name="user_id"]').val();
        for(var i=0; i < global_user.length; i++){
            if(global_user[i]['id'] == user_id){
                $('input[name="user_mobile"]').val(global_user[i]['mobile']);
                break;
            }
        }

    </script>
</block>