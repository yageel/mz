<extend name="Layout/master"/>
<block name="title">刮刮卡记录详情-</block>
<block name="head">
</block>
<block name="content">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class=""><a href="{:U('/card/history')}" target="_self" class="btn btn-primary ">返回</a></div>
                <div class="ibox-title">
                    <h5>
                        <a href="{:U('/card/history')}">刮刮卡记录</a>
                        >
                        <small>刮刮卡记录详情</small>
                    </h5>
                    <div class="ibox-tools">
                        <a class="collapse-link"> <i class="fa fa-chevron-up"></i></a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover">
                            <tr>
                                <th width="160">ID</th>
                                <td>{$model['id']}</td>
                            </tr>
                            <tr>
                                <th>手机ID</th>
                                <td>{$model['uid']}</td>
                            </tr>
                            <tr>
                                <th>用户ID</th>
                                <td>{$model['user_id']}</td>
                            </tr>
                            <tr>
                                <th>OpenID</th>
                                <td>{$model['openid']}</td>
                            </tr>
                            <tr>
                                <th>公众号</th>
                                <td>{$city}</td>
                            </tr>
                            <tr>
                                <th>状态</th>
                                <td>{$status_map[$model['status']]}</td>
                            </tr>
                            <tr>
                                <th>类型</th>
                                <td>
                                    {$type_map[$model['type']]}
                                </td>
                            </tr>
                            <tr>
                                <th>奖品</th>
                                <td>{$model['item']}</td>
                            </tr>
                            <if condition="($model['type'] EQ $type_entity) AND ($model['status'] NEQ $status_close)">
                            <tr>
                                <th>收货人</th>
                                <td>{$model['real_name']}</td>
                            </tr>
                            <tr>
                                <th>联系电话</th>
                                <td>{$model['phone']}</td>
                            </tr>
                            <tr>
                                <th>收货地区</th>
                                <td>{$model['address']}</td>
                            </tr>
                            <tr>
                                <th>详细地址</th>
                                <td>{$model['detail_address']}</td>
                            </tr>
                            <tr>
                                <th>备注</th>
                                <td>{$model['remark']}</td>
                            </tr>
                            <tr>
                                <th>物流公司</th>
                                <td>
                                    <div class="row col-md-5">
                                        <input id="express_company" class="form-control" value="{$model['express_company']}">
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>物流单号</th>
                                <td>
                                    <div class="row col-md-5">
                                        <input id="express_no" class="form-control" value="{$model['express_no']}">
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>发货时间</th>
                                <td>{:timestampToDate($model['express_time'])}</td>
                            </tr>
                            </if>
                            <tr>
                                <th>创建时间</th>
                                <td>{:timestampToDate($model['created_at'])}</td>
                            </tr>
                            <tr>
                                <th>刮卡时间</th>
                                <td>{:timestampToDate($model['updated_at'])}</td>
                            </tr>
                        </table>
                        <if condition="($model['type'] eq $type_entity) AND ($model['status'] NEQ $status_close)">
                        <button type="button" id="shipment" class="btn btn-success">发货</button>
                        </if>
                    </div>
                </div>
            </div>
        </div>
    </div>
</block>
<block name="js">
    <script>
        $("#shipment").click(function () {
            <if condition="$model['status'] eq $status_consignment">
            if (!confirm("该记录已经发货了，确定要修改物流信息吗？")) {
                return false;
            }
            </if>
            var express_company = $("#express_company").val();
            var express_no = $("#express_no").val();
            if (express_company == "") {
                alert("物流公司不能为空");
                $("#express_company").focus();
                return false;
            }
            if (express_no == "") {
                alert("物流编号不能为空");
                $("#express_no").focus();
                return false;
            }
            $.ajax({
                type: "post",
                dataType: "json",
                url: "{:U('/card/store', ['id' => $model['id']])}",
                data: {
                    "express_company": express_company,
                    "express_no": express_no
                },
                success: function(data) {
                    alert(data.msg);
                    if (data.status == "success") {
                        window.location.reload();
                    }
                },
                error: function() {
                    alert("保存失败");
                }
            });
        });
    </script>
</block>
